<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gi√°m Kh·∫£o ‚Äì Dashboard</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f1f5f9;
        padding: 20px;
    }
    h1 {
        margin-bottom: 10px;
    }
    button {
        padding: 10px 20px;
        font-size: 16px;
        background: #2563eb;
        color: #fff;
        border: none;
        cursor: pointer;
        margin-bottom: 20px;
    }
    button:disabled {
        background: #94a3b8;
        cursor: not-allowed;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        background: #fff;
        margin-bottom: 30px;
    }
    th, td {
        border: 1px solid #cbd5e1;
        padding: 8px;
        text-align: left;
        font-size: 14px;
    }
    th {
        background: #e2e8f0;
    }
    .danger {
        color: red;
        font-weight: bold;
    }
    .success {
        color: green;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>üë®‚Äç‚öñÔ∏è DASHBOARD GI√ÅM KH·∫¢O</h1>

<button id="startBtn" onclick="startExam()">üöÄ B·∫ÆT ƒê·∫¶U K·ª≤ THI</button>

<h2>üìã K·∫øt qu·∫£ th√≠ sinh</h2>
<table id="results">
    <tr>
        <th>H·ªç t√™n</th>
        <th>ƒêi·ªÉm</th>
        <th>K·∫øt qu·∫£</th>
        <th>Th·ªùi gian n·ªôp</th>
    </tr>
</table>

<h2>üö® Log gian l·∫≠n</h2>
<table id="logs">
    <tr>
        <th>H·ªç t√™n</th>
        <th>Lo·∫°i</th>
        <th>L√Ω do</th>
        <th>Th·ªùi gian</th>
    </tr>
</table>

<script>
const resultsTable = document.getElementById("results");
const startBtn = document.getElementById("startBtn");

const API_BASE = location.origin;

async function load() {
    try {
        const res = await fetch(API_BASE + "/api/dashboard");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        // Update n√∫t start
        if (data.started) {
            startBtn.disabled = true;
            startBtn.innerText = "‚è≥ K·ª≥ thi ƒëang di·ªÖn ra";
        }

        // Render k·∫øt qu·∫£
        resultsTable.innerHTML = `
            <tr>
                <th>H·ªç t√™n</th>
                <th>ƒêi·ªÉm</th>
                <th>K·∫øt qu·∫£</th>
                <th>Th·ªùi gian</th>
            </tr>
        ` + data.results.map(r => `
            <tr>
                <td>${r.name}</td>
                <td>${r.score}/10</td>
                <td style="font-weight:bold;color:${r.result === "ƒê·∫¨U" ? "green" : "red"}">
                    ${r.result}
                </td>
                <td>${r.time}</td>
            </tr>
        `).join("");

    } catch (err) {
        console.warn("‚ö†Ô∏è Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server", err.message);
    }
}

load();
setInterval(load, 2000);
</script>


</body>
</html>
